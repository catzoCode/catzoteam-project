{% extends 'registration_portal/base.html' %}

{% block title %}Search Customer Â· Catzonia{% endblock %}

{% block content %}
<!-- NAVBAR -->
<nav class="navbar-apple">
    <div class="navbar-content">
        <a href="{% url 'registration_portal:dashboard' %}" class="navbar-brand">
            <i class="fas fa-cat"></i>
            <span>Catzonia</span>
        </a>
        <div class="navbar-actions">
            <div class="navbar-badge">
                <i class="fas fa-building"></i> {{ user.get_branch_display }}
            </div>
            <div class="navbar-badge">
                <i class="fas fa-user-circle"></i> {{ user.first_name|default:user.username }}
            </div>
            <a href="{% url 'registration_portal:dashboard' %}" class="btn-apple btn-apple-sm btn-secondary">
                <i class="fas fa-arrow-left"></i> Back
            </a>
        </div>
    </div>
</nav>

<!-- MAIN CONTENT -->
<div class="container-apple">
    <!-- SEARCH CARD -->
    <div class="card-apple mb-6 animate-fade-in-up">
        <div class="card-header-apple">
            <h2>Search Customer</h2>
        </div>
        <div class="card-body-apple">
            <form method="post">
                {% csrf_token %}
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-4); margin-bottom: var(--space-4);">
                    <div class="input-group">
                        <label class="input-label">
                            <i class="fas fa-search"></i> Name or Customer ID
                        </label>
                        <input type="text" 
                               name="search_query" 
                               class="input-apple" 
                               placeholder="Enter name or ID..."
                               value="{{ request.POST.search_query }}"
                               autofocus>
                    </div>
                    
                    <div class="input-group">
                        <label class="input-label">
                            <i class="fas fa-phone"></i> Phone Number
                        </label>
                        <input type="text" 
                               name="search_phone" 
                               class="input-apple" 
                               placeholder="Enter phone number..."
                               value="{{ request.POST.search_phone }}">
                    </div>
                </div>
                
                <div class="flex gap-3">
                    <button type="submit" class="btn-apple btn-primary" style="flex: 1;">
                        <i class="fas fa-search"></i> Search
                    </button>
                    <a href="{% url 'registration_portal:register_customer' %}" class="btn-apple btn-success" style="flex: 1;">
                        <i class="fas fa-plus"></i> New Customer
                    </a>
                </div>
            </form>
        </div>
    </div>

    <!-- SEARCH RESULTS -->
    {% if search_performed %}
    <div class="card-apple animate-fade-in-up">
        <div class="card-header-apple">
            <h2>Search Results</h2>
            <div class="navbar-badge">{{ customers.count }} found</div>
        </div>
        <div class="card-body-apple">
            {% if customers %}
                <div style="display: flex; flex-direction: column; gap: var(--space-4);">
                    {% for customer in customers %}
                    <div class="card-apple" style="margin: 0;">
                        <div class="card-body-apple" style="padding: var(--space-5);">
                            <div class="flex items-center justify-between">
                                <div style="flex: 1;">
                                    <h3 class="text-xl font-semibold mb-2">
                                        <i class="fas fa-user"></i> {{ customer.name }}
                                    </h3>
                                    <div class="text-secondary mb-2">
                                        <span class="navbar-badge" style="margin-right: var(--space-2);">
                                            <i class="fas fa-id-card"></i> {{ customer.customer_id }}
                                        </span>
                                        <span class="navbar-badge">
                                            <i class="fas fa-phone"></i> {{ customer.phone }}
                                        </span>
                                    </div>
                                    {% if customer.ic_number %}
                                    <div class="text-sm text-secondary">
                                        <i class="fas fa-id-badge"></i> IC: {{ customer.ic_number }}
                                    </div>
                                    {% endif %}
                                </div>
                                <div style="display: flex; flex-direction: column; gap: var(--space-2); min-width: 200px;">
                                    <a href="{% url 'registration_portal:create_service_request' customer.customer_id %}" 
                                       class="btn-apple btn-success btn-apple-lg">
                                        <i class="fas fa-plus-circle"></i> Create Booking
                                    </a>
                                    <a href="{% url 'registration_portal:customer_detail' customer.customer_id %}" 
                                       class="btn-apple btn-apple-sm btn-ghost">
                                        <i class="fas fa-eye"></i> View Details
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-state">
                    <div class="empty-icon"><i class="fas fa-search"></i></div>
                    <h3 class="text-xl font-semibold mb-2">No customers found</h3>
                    <p class="text-secondary mb-4">Try a different search or register a new customer</p>
                    <a href="{% url 'registration_portal:register_customer' %}" class="btn-apple btn-success">
                        <i class="fas fa-plus"></i> Register New Customer
                    </a>
                </div>
            {% endif %}
        </div>
    </div>
    {% else %}
    <!-- EMPTY STATE (No search yet) -->
    <div class="empty-state animate-fade-in-up">
        <div class="empty-icon" style="color: var(--apple-blue);"><i class="fas fa-search"></i></div>
        <h3 class="text-2xl font-semibold mb-2">Search for a customer</h3>
        <p class="text-secondary">Enter customer name, ID, or phone number above to start</p>
    </div>
    {% endif %}
</div>

<style>
/* Additional styles for search results */
@media (max-width: 768px) {
    .card-body-apple .flex {
        flex-direction: column;
        align-items: stretch !important;
    }
    
    .card-body-apple .flex > div:last-child {
        width: 100% !important;
        min-width: 100% !important;
    }
}
</style>
{% endblock %}