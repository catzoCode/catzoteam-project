{% extends 'registration_portal/base.html' %}

{% block title %}Register Cat ¬∑ Catzonia{% endblock %}

{% block content %}
<!-- NAVBAR -->
<nav class="navbar-apple">
    <div class="navbar-content">
        <a href="{% url 'registration_portal:dashboard' %}" class="navbar-brand">
            <i class="fas fa-cat"></i>
            <span>Catzonia</span>
        </a>
        <div class="navbar-actions">
            <div class="navbar-badge">
                <i class="fas fa-building"></i> {{ user.get_branch_display }}
            </div>
            <div class="navbar-badge">
                <i class="fas fa-user-circle"></i> {{ user.first_name|default:user.username }}
            </div>
            <a href="{% url 'registration_portal:customer_detail' customer.customer_id %}" class="btn-apple btn-apple-sm btn-secondary">
                <i class="fas fa-arrow-left"></i> Back
            </a>
        </div>
    </div>
</nav>

<!-- MAIN CONTENT -->
<div class="container-apple">
    <!-- Customer Info Banner -->
    <div class="card-apple mb-4 animate-fade-in-up" style="border: 2px solid var(--apple-blue);">
        <div class="card-body-apple">
            <div class="flex items-center justify-between">
                <div>
                    <h3 class="text-xl font-semibold mb-2">
                        <i class="fas fa-user-circle"></i> {{ customer.name }}
                    </h3>
                    <div class="text-secondary">
                        <span class="navbar-badge" style="margin-right: var(--space-2);">
                            <i class="fas fa-phone"></i> {{ customer.phone }}
                        </span>
                        <span class="navbar-badge">
                            <i class="fas fa-id-card"></i> {{ customer.customer_id }}
                        </span>
                    </div>
                </div>
                <a href="{% url 'registration_portal:create_service_request' customer.customer_id %}" 
                   class="btn-apple btn-primary">
                    <i class="fas fa-fast-forward"></i> Skip to Booking
                </a>
            </div>
        </div>
    </div>

    <!-- Existing Cats -->
    {% if cats %}
    <div class="card-apple mb-6 animate-fade-in-up">
        <div class="card-header-apple">
            <h2><i class="fas fa-cat"></i> Registered Cats</h2>
            <div class="navbar-badge">{{ cats.count }} cat(s)</div>
        </div>
        <div class="card-body-apple">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: var(--space-4);">
                {% for cat in cats %}
                <div class="card-apple" style="margin: 0;">
                    <div class="card-body-apple">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="text-lg font-semibold">
                                üê± {{ cat.name }}
                            </h3>
                            {% if cat.vaccination_status == 'up_to_date' %}
                            <span class="tile-badge" style="background: var(--apple-green);">‚úì Vaccinated</span>
                            {% elif cat.vaccination_status == 'overdue' %}
                            <span class="tile-badge" style="background: var(--apple-orange);">‚ö† Overdue</span>
                            {% elif cat.vaccination_status == 'not_vaccinated' %}
                            <span class="tile-badge" style="background: var(--apple-red);">‚úó Not Vaccinated</span>
                            {% else %}
                            <span class="tile-badge">? Unknown</span>
                            {% endif %}
                        </div>
                        
                        <div class="text-sm text-secondary mb-2">
                            <i class="fas fa-tag"></i> {{ cat.cat_id }}
                        </div>
                        
                        <div class="text-sm mb-3">
                            <strong>Breed:</strong> {{ cat.breed }}<br>
                            <strong>Age:</strong> {{ cat.age }} years<br>
                            <strong>Gender:</strong> {{ cat.get_gender_display }}
                            {% if cat.color %}<br><strong>Color:</strong> {{ cat.color }}{% endif %}
                            {% if cat.weight %}<br><strong>Weight:</strong> {{ cat.weight }} kg{% endif %}
                        </div>
                        
                        {% if cat.medical_notes %}
                        <div style="padding: var(--space-3); background: #fff3cd; border-radius: var(--radius-md); margin-bottom: var(--space-2);">
                            <div class="text-sm"><strong>Medical:</strong> {{ cat.medical_notes|truncatewords:10 }}</div>
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Register New Cat Form -->
    <div class="card-apple animate-fade-in-up">
        <div class="card-header-apple">
            <h2><i class="fas fa-plus-circle"></i> Register New Cat</h2>
        </div>
        <div class="card-body-apple">
            <form method="post" action="{% url 'registration_portal:register_cat' customer.customer_id %}">
                {% csrf_token %}
                
                <!-- Basic Information -->
                <h3 class="text-lg font-semibold mb-4" style="color: var(--apple-blue);">
                    <i class="fas fa-info-circle"></i> Basic Information
                </h3>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-4); margin-bottom: var(--space-4);">
                    <div class="input-group">
                        <label class="input-label">Cat Name *</label>
                        <input type="text" 
                               name="name" 
                               class="input-apple" 
                               placeholder="Enter cat's name"
                               required>
                    </div>
                    
                    <div class="input-group">
                        <label class="input-label">Breed *</label>
                        <select name="breed" class="input-apple" required>
                            <option value="mixed">Mixed Breed</option>
                            <option value="persian">Persian</option>
                            <option value="siamese">Siamese</option>
                            <option value="maine_coon">Maine Coon</option>
                            <option value="british_shorthair">British Shorthair</option>
                            <option value="ragdoll">Ragdoll</option>
                            <option value="bengal">Bengal</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--space-4); margin-bottom: var(--space-4);">
                    <div class="input-group">
                        <label class="input-label">Age (years) *</label>
                        <input type="number" 
                               name="age" 
                               class="input-apple" 
                               min="0" 
                               max="30"
                               placeholder="0"
                               required>
                    </div>
                    
                    <div class="input-group">
                        <label class="input-label">Gender *</label>
                        <select name="gender" class="input-apple" required>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                        </select>
                    </div>
                    
                    <div class="input-group">
                        <label class="input-label">Color</label>
                        <input type="text" 
                               name="color" 
                               class="input-apple" 
                               placeholder="e.g., Orange">
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-4); margin-bottom: var(--space-6);">
                    <div class="input-group">
                        <label class="input-label">Weight (kg)</label>
                        <input type="number" 
                               name="weight" 
                               class="input-apple" 
                               step="0.1"
                               min="0"
                               placeholder="e.g., 4.5">
                    </div>
                    
                    <div class="input-group">
                        <label class="input-label">Vaccination Status</label>
                        <select name="vaccination_status" class="input-apple">
                            <option value="unknown">Unknown</option>
                            <option value="up_to_date">Up to Date</option>
                            <option value="overdue">Overdue</option>
                            <option value="not_vaccinated">Not Vaccinated</option>
                        </select>
                    </div>
                </div>
                
                <!-- Health Information -->
                <h3 class="text-lg font-semibold mb-4" style="color: var(--apple-blue);">
                    <i class="fas fa-heart-pulse"></i> Health Information
                </h3>
                
                <div class="input-group" style="margin-bottom: var(--space-4);">
                    <label class="input-label">Medical Notes & Allergies *</label>
                    <textarea name="medical_notes" 
                              class="input-apple" 
                              rows="3" 
                              placeholder="List any allergies, medical conditions, or current medications..."
                              required></textarea>
                    <p class="text-sm text-secondary" style="margin-top: var(--space-2);">
                        This is important for the safety of the cat
                    </p>
                </div>
                
                <div class="input-group" style="margin-bottom: var(--space-6);">
                    <label class="input-label">Special Requirements</label>
                    <textarea name="special_requirements" 
                              class="input-apple" 
                              rows="2" 
                              placeholder="Any special care instructions, dietary needs, or behavioral notes..."></textarea>
                </div>
                
                <!-- Actions -->
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: var(--space-3);">
                    <a href="{% url 'registration_portal:customer_detail' customer.customer_id %}" 
                       class="btn-apple btn-secondary">
                        <i class="fas fa-times"></i> Cancel
                    </a>
                    <button type="submit" 
                            name="action" 
                            value="another" 
                            class="btn-apple btn-primary">
                        <i class="fas fa-plus"></i> Add Another
                    </button>
                    <button type="submit" 
                            name="action" 
                            value="service" 
                            class="btn-apple btn-success">
                        <i class="fas fa-check"></i> Save & Book
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
@media (max-width: 768px) {
    .card-body-apple > form > div[style*="grid-template-columns"] {
        grid-template-columns: 1fr !important;
    }
}
</style>
{% endblock %}