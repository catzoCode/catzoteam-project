{% extends 'registration_portal/base.html' %}

{% block title %}OCR Upload Â· Catzonia{% endblock %}

{% block content %}
<!-- NAVBAR -->
<nav class="navbar-apple">
    <div class="navbar-content">
        <a href="{% url 'registration_portal:dashboard' %}" class="navbar-brand">
            <i class="fas fa-cat"></i>
            <span>Catzonia</span>
        </a>
        <div class="navbar-actions">
            <div class="navbar-badge">
                <i class="fas fa-building"></i> {{ user.get_branch_display }}
            </div>
            <div class="navbar-badge">
                <i class="fas fa-user-circle"></i> {{ user.first_name|default:user.username }}
            </div>
            <a href="{% url 'registration_portal:dashboard' %}" class="btn-apple btn-apple-sm btn-secondary">
                <i class="fas fa-arrow-left"></i> Back
            </a>
        </div>
    </div>
</nav>

<!-- MAIN CONTENT -->
<div class="container-apple">
    <div class="card-apple animate-fade-in-up" style="max-width: 700px; margin: 0 auto;">
        <div class="card-header-apple">
            <h2><i class="fas fa-camera"></i> Upload Portal Collar Screenshot</h2>
        </div>
        <div class="card-body-apple">
            <!-- Info Box -->
            <div style="padding: var(--space-5); background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: var(--radius-lg); margin-bottom: var(--space-6); color: white;">
                <div style="display: flex; align-items: center; gap: var(--space-4);">
                    <div style="font-size: 60px;">ðŸ“¸</div>
                    <div>
                        <h3 class="text-xl font-semibold mb-2">Automatic Customer Registration</h3>
                        <p style="opacity: 0.9;">Upload a Portal Collar screenshot and we'll extract customer data automatically using OCR technology</p>
                    </div>
                </div>
            </div>

            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}
                
                <!-- File Upload Area -->
                <div class="input-group" style="margin-bottom: var(--space-6);">
                    <label class="input-label">
                        <i class="fas fa-image"></i> Select Screenshot
                    </label>
                    <div style="border: 2px dashed var(--border-color); border-radius: var(--radius-lg); padding: var(--space-8); text-align: center; background: var(--apple-gray-50); transition: all 0.2s;">
                        <input type="file" 
                               name="screenshot" 
                               accept="image/*" 
                               class="input-apple"
                               required
                               id="screenshotInput"
                               style="display: none;">
                        <label for="screenshotInput" style="cursor: pointer; display: block;">
                            <div style="font-size: 80px; margin-bottom: var(--space-4); color: var(--apple-blue);">
                                ðŸ“±
                            </div>
                            <div class="text-lg font-semibold mb-2">
                                Click to upload screenshot
                            </div>
                            <div class="text-sm text-secondary">
                                JPG, PNG, or WEBP (Max 5MB)
                            </div>
                        </label>
                        <div id="fileName" class="text-sm font-semibold" style="margin-top: var(--space-3); color: var(--apple-green); display: none;">
                            <i class="fas fa-check-circle"></i> <span></span>
                        </div>
                    </div>
                </div>

                <!-- Instructions -->
                <div style="padding: var(--space-5); background: #e3f2fd; border-radius: var(--radius-lg); margin-bottom: var(--space-6); border-left: 4px solid var(--apple-blue);">
                    <h3 class="font-semibold mb-3" style="color: var(--apple-blue);">
                        <i class="fas fa-info-circle"></i> Tips for Best Results
                    </h3>
                    <ul style="margin: 0; padding-left: var(--space-5);">
                        <li style="margin-bottom: var(--space-2);">Take a clear screenshot of the Portal Collar booking page</li>
                        <li style="margin-bottom: var(--space-2);">Make sure customer name and phone number are visible</li>
                        <li style="margin-bottom: var(--space-2);">Avoid blurry or low-resolution images</li>
                        <li>Good lighting helps OCR accuracy</li>
                    </ul>
                </div>

                <!-- What Gets Extracted -->
                <div style="padding: var(--space-5); background: #fff3cd; border-radius: var(--radius-lg); margin-bottom: var(--space-6); border-left: 4px solid var(--apple-orange);">
                    <h3 class="font-semibold mb-3" style="color: var(--apple-orange);">
                        <i class="fas fa-magic"></i> What We'll Extract
                    </h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-3);">
                        <div>
                            <div class="text-sm text-secondary">âœ“ Customer Name</div>
                            <div class="text-sm text-secondary">âœ“ Phone Number</div>
                            <div class="text-sm text-secondary">âœ“ IC Number (if visible)</div>
                        </div>
                        <div>
                            <div class="text-sm text-secondary">âœ“ Service Type</div>
                            <div class="text-sm text-secondary">âœ“ Booking Date</div>
                            <div class="text-sm text-secondary">âœ“ Additional Notes</div>
                        </div>
                    </div>
                </div>

                <!-- Actions -->
                <div class="flex gap-3">
                    <a href="{% url 'registration_portal:dashboard' %}" 
                       class="btn-apple btn-secondary" 
                       style="flex: 1;">
                        <i class="fas fa-times"></i> Cancel
                    </a>
                    <button type="submit" 
                            class="btn-apple btn-success btn-apple-lg" 
                            style="flex: 2;">
                        <i class="fas fa-upload"></i> Upload & Extract
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- How It Works -->
    <div class="card-apple animate-fade-in-up" style="max-width: 700px; margin: var(--space-6) auto 0;">
        <div class="card-header-apple">
            <h2><i class="fas fa-question-circle"></i> How It Works</h2>
        </div>
        <div class="card-body-apple">
            <div style="display: flex; flex-direction: column; gap: var(--space-4);">
                <div style="display: flex; gap: var(--space-4); align-items: center;">
                    <div style="width: 50px; height: 50px; background: var(--apple-blue); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; flex-shrink: 0;">
                        1
                    </div>
                    <div>
                        <div class="font-semibold mb-1">Upload Screenshot</div>
                        <div class="text-sm text-secondary">Take a screenshot from Portal Collar and upload it</div>
                    </div>
                </div>

                <div style="display: flex; gap: var(--space-4); align-items: center;">
                    <div style="width: 50px; height: 50px; background: var(--apple-purple); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; flex-shrink: 0;">
                        2
                    </div>
                    <div>
                        <div class="font-semibold mb-1">OCR Processing</div>
                        <div class="text-sm text-secondary">Our system automatically extracts customer data</div>
                    </div>
                </div>

                <div style="display: flex; gap: var(--space-4); align-items: center;">
                    <div style="width: 50px; height: 50px; background: var(--apple-orange); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; flex-shrink: 0;">
                        3
                    </div>
                    <div>
                        <div class="font-semibold mb-1">Review & Edit</div>
                        <div class="text-sm text-secondary">Check the extracted data and make any corrections</div>
                    </div>
                </div>

                <div style="display: flex; gap: var(--space-4); align-items: center;">
                    <div style="width: 50px; height: 50px; background: var(--apple-green); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; flex-shrink: 0;">
                        4
                    </div>
                    <div>
                        <div class="font-semibold mb-1">Create Customer</div>
                        <div class="text-sm text-secondary">Customer is registered and ready for cat registration</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('screenshotInput').addEventListener('change', function(e) {
    const fileName = e.target.files[0]?.name;
    if (fileName) {
        const fileNameDiv = document.getElementById('fileName');
        fileNameDiv.querySelector('span').textContent = fileName;
        fileNameDiv.style.display = 'block';
    }
});
</script>
{% endblock %}